<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSV File Generator</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; background: #f5f5f5; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { color: #333; text-align: center; }
        .input-area { border: 2px solid #007bff; padding: 40px; text-align: center; margin: 20px 0; border-radius: 8px; background: #f8f9ff; }
        .input-group { margin: 15px 0; }
        input[type="number"] { padding: 12px; font-size: 18px; border: 2px solid #ddd; border-radius: 4px; width: 200px; text-align: center; }
        .checkbox-group { margin: 20px 0; }
        input[type="checkbox"] { transform: scale(1.5); margin-right: 10px; }
        label { font-size: 16px; font-weight: bold; }
        .conditional-input { display: none; margin-top: 15px; padding: 15px; background: #e8f4fd; border-radius: 5px; border-left: 4px solid #007bff; }
        .conditional-input.show { display: block; }
        button { background: #007bff; color: white; padding: 15px 30px; border: none; border-radius: 4px; cursor: pointer; font-size: 18px; margin-top: 15px; }
        button:hover { background: #0056b3; }
        .result { margin-top: 20px; padding: 15px; background: #e8f5e8; border-radius: 4px; display: none; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        .mode-explanation { font-size: 14px; color: #666; margin-top: 10px; }
    </style>
</head>
<body>
<div class="container">
    <h1>üöÄ CSV File Generator</h1>
    <p><strong></strong></p>

    <div class="input-area">
        <form id="generateForm">
            <!-- Input 1: Number of files -->
            <div class="input-group">
                <p>üìä <strong>How many CSV files do you want to generate?</strong></p>
                <input type="number" id="countInput" name="count" min="1" max="1000" value="10" required>
            </div>

            <!-- Input 2: Same file mode checkbox -->
            <div class="checkbox-group">
                <label>
                    <input type="checkbox" id="sameFileModeCheckbox" name="sameFileMode">
                    üìù Same file mode (Multiple rows per file)
                </label>
                <div class="mode-explanation">
                    <div id="normalModeText">Normal mode: Each file will contain 1 row</div>
                    <div id="sameFileModeText" style="display: none;">Same file mode: Each file will contain multiple rows</div>
                </div>
            </div>

            <!-- Input 3: Rows per file (conditional) -->
            <div class="conditional-input" id="rowsPerFileSection">
                <p>üìã <strong>How many rows in each file?</strong></p>
                <input type="number" id="rowsPerFileInput" name="rowsPerFile" min="1" value="5">
                <div class="mode-explanation">
                    Each CSV file will contain this many rows of data
                </div>
            </div>

            <button type="submit">Generate CSV Files</button>
        </form>
    </div>

    <div class="info result" style="display: block;">
        <h4>üìù How it works:</h4>
        <ul>
            <li><strong>Position 8:</strong> Starts from 2000, increments +1 for each row</li>
            <li><strong>Date (Position 9):</strong> Tomorrow's date for all files</li>
            <li><strong>All other data:</strong> Same hardcoded template</li>
            <li><strong>Files saved in:</strong> generated_files/ folder</li>
        </ul>
        <div id="exampleText">
            <strong>Example:</strong> 10 files ‚Üí 10 separate files (each with 1 row)
        </div>
    </div>

    <div id="result" class="result"></div>
</div>

<script>
    const sameFileModeCheckbox = document.getElementById('sameFileModeCheckbox');
    const rowsPerFileSection = document.getElementById('rowsPerFileSection');
    const normalModeText = document.getElementById('normalModeText');
    const sameFileModeText = document.getElementById('sameFileModeText');
    const countInput = document.getElementById('countInput');
    const rowsPerFileInput = document.getElementById('rowsPerFileInput');
    const exampleText = document.getElementById('exampleText');

    // Show/hide rows per file input based on checkbox
    sameFileModeCheckbox.addEventListener('change', function() {
        if (this.checked) {
            rowsPerFileSection.classList.add('show');
            normalModeText.style.display = 'none';
            sameFileModeText.style.display = 'block';
        } else {
            rowsPerFileSection.classList.remove('show');
            normalModeText.style.display = 'block';
            sameFileModeText.style.display = 'none';
        }
        updateExample();
    });

    // Update example when inputs change
    countInput.addEventListener('input', updateExample);
    rowsPerFileInput.addEventListener('input', updateExample);

    function updateExample() {
        const fileCount = parseInt(countInput.value) || 10;
        const rowsPerFile = parseInt(rowsPerFileInput.value) || 5;

        if (sameFileModeCheckbox.checked) {
            const totalRows = fileCount * rowsPerFile;
            exampleText.innerHTML = `<strong>Example:</strong> ${fileCount} files ‚Üí ${fileCount} separate files (each with ${rowsPerFile} rows = ${totalRows} total rows)`;
        } else {
            exampleText.innerHTML = `<strong>Example:</strong> ${fileCount} files ‚Üí ${fileCount} separate files (each with 1 row)`;
        }
    }

    // Form submission
    document.getElementById('generateForm').addEventListener('submit', async function(e) {
        e.preventDefault();

        const resultDiv = document.getElementById('result');
        const count = parseInt(countInput.value);
        const sameFileMode = sameFileModeCheckbox.checked;
        const rowsPerFile = sameFileMode ? parseInt(rowsPerFileInput.value) : 1;

        if (!count || count < 1 || count > 1000) {
            alert('Please enter a valid number of files between 1 and 1000!');
            return;
        }

        if (sameFileMode && (!rowsPerFile || rowsPerFile < 1)) {
            alert('Please enter a valid number of rows per file (minimum 1)!');
            return;
        }

        try {
            const processingText = sameFileMode ?
                `‚è≥ Generating ${count} files with ${rowsPerFile} rows each (${count * rowsPerFile} total rows)...` :
                `‚è≥ Generating ${count} files with 1 row each...`;

            resultDiv.innerHTML = `<p>${processingText}</p>`;
            resultDiv.style.display = 'block';
            resultDiv.className = 'result';

            // Build API URL with parameters
            let apiUrl = `/api/csv/generate?count=${count}`;
            if (sameFileMode) {
                apiUrl += `&rowsPerFile=${rowsPerFile}`;
            }

            const response = await fetch(apiUrl, {
                method: 'POST'
            });

            const result = await response.json();
            console.log('API Response:', result);

            if (response.ok && result.success) {
                const data = result.data;

                resultDiv.innerHTML = `
                    <h3>‚úÖ Success!</h3>
                    <p><strong>Message:</strong> ${result.message}</p>
                    <p><strong>Files Generated:</strong> ${data.totalFilesGenerated}</p>
                    <p><strong>Output Directory:</strong> ${data.outputDirectory}</p>
                    <p><strong>Tomorrow's Date Used:</strong> ${data.tomorrowDate}</p>
                    <p><strong>Position 8 Range:</strong> ${data.startingPosition8Value} to ${data.endingPosition8Value}</p>
                    ${data.rowsPerFile ? `<p><strong>Rows per File:</strong> ${data.rowsPerFile}</p>` : ''}
                    ${data.totalRows ? `<p><strong>Total Rows Generated:</strong> ${data.totalRows}</p>` : ''}
                    <p><strong>Timestamp:</strong> ${data.timestamp}</p>
                    <p><strong>üéâ All files are ready in the ${data.outputDirectory} folder!</strong></p>
                `;
                resultDiv.className = 'result';
            } else {
                const errorMessage = result.error || result.message || 'Generation failed';
                throw new Error(errorMessage);
            }
        } catch (error) {
            console.error('Error:', error);
            resultDiv.innerHTML = `<h3>‚ùå Error!</h3><p>${error.message}</p>`;
            resultDiv.className = 'result error';
        }
    });

    // Initialize example
    updateExample();
</script>
</body>
</html>
